<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Transaction details in SpendNote.">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" type="image/x-icon" href="favicon.ico">
    <title>Transaction — - SpendNote</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/main.css?v=11">
    <link rel="stylesheet" href="assets/css/app-layout.css?v=13">
    <style>
        /* ===== TRANSACTION DETAIL - CLEAN REDESIGN ===== */

        .main-content {
            padding-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .tx-topbar {
            border-radius: 16px;
            padding: 12px;
            border: 1px solid rgba(0,0,0,0.08);
            position: relative;
        }

        .tx-topbar.in {
            --dir: var(--primary);
            --dir-rgb: 5, 150, 105;
            background: rgba(5, 150, 105, 0.10);
        }

        .tx-topbar.out {
            --dir: var(--out);
            --dir-rgb: var(--out-rgb);
            background: rgba(var(--out-rgb), 0.06);
        }

        .tx-topbar-inner {
            display: grid;
            grid-template-columns: 1.4fr 0.8fr 1fr;
            gap: 12px;
            align-items: stretch;
        }

        @media (max-width: 1100px) {
            .tx-topbar-inner {
                grid-template-columns: 1fr;
            }
        }

        .tx-topbar-card {
            background: rgba(255,255,255,0.92);
            border: 1px solid rgba(0,0,0,0.08);
            border-radius: 14px;
            padding: 10px 12px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 1px 2px rgba(0,0,0,0.04);
        }

        .tx-info-card {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .tx-info-watermark {
            position: absolute;
            right: 14px;
            top: 50%;
            font-size: 72px;
            font-weight: 900;
            letter-spacing: -0.06em;
            opacity: 0.10;
            pointer-events: none;
            user-select: none;
            color: var(--dir, var(--primary));
            line-height: 1;
            transform: translateY(-50%);
        }

        .tx-id-top {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tx-type-pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 900;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            background: rgba(var(--dir-rgb, 5, 150, 105), 0.18);
            color: var(--dir, var(--primary));
        }

        .tx-type-pill.out {
            background: rgba(var(--out-rgb), 0.18);
            color: var(--out);
        }

        .tx-id-label {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted);
        }

        .tx-id-value {
            font-size: 20px;
            font-weight: 900;
            letter-spacing: -0.02em;
            color: var(--text);
            margin: 0;
            line-height: 1.1;
        }

        .tx-icon {
            width: 56px;
            height: 56px;
            background: rgba(var(--active-rgb), 0.12);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .tx-icon i {
            font-size: 24px;
            color: var(--active);
        }

        .tx-icon.out {
            background: rgba(var(--out-rgb), 0.12);
        }

        .tx-icon.out i {
            color: var(--out);
        }

        .header-info h1 {
            font-size: 22px;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin: 0 0 4px 0;
            color: var(--text);
        }

        .header-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .header-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .cashbox-chip {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(255,255,255,0.70);
            border: 1px solid rgba(0,0,0,0.10);
            color: var(--text);
            font-weight: 600;
        }

        .cashbox-dot {
            width: 10px;
            height: 10px;
            border-radius: 999px;
            background: var(--active);
            box-shadow: 0 0 0 3px rgba(var(--active-rgb), 0.18);
        }

        .tx-amount-card {
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
        }

        .header-amount-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .header-amount-value {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -0.02em;
        }

        .header-amount-value.in { color: var(--primary); }
        .header-amount-value.out { color: var(--out); }

        .tx-actions-card {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            align-items: center;
        }

        .tx-actions-card .btn {
            height: 44px;
            width: 100%;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
        }

        .header-menu {
            position: absolute;
            right: 0;
            top: calc(100% + 8px);
            min-width: 220px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.10);
            padding: 6px;
            z-index: 50;
            display: none;
        }

        .kebab-container {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 60;
        }

        .kebab-container .btn {
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header-menu.open {
            display: block;
        }

        .header-menu button {
            width: 100%;
            text-align: left;
            padding: 10px 12px;
            border-radius: 10px;
            border: none;
            background: transparent;
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-menu button:hover {
            background: var(--bg);
        }

        .header-menu .danger {
            color: var(--error);
        }

        .type-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .type-badge.in {
            background: rgba(var(--active-rgb), 0.15);
            color: var(--active);
        }

        .type-badge.out {
            background: rgba(var(--out-rgb), 0.15);
            color: var(--out);
        }

        .btn-small {
            padding: 8px 14px;
            font-size: 13px;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* INFO CARDS ROW */
        .info-cards-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .info-cards-row {
                grid-template-columns: 1fr;
            }
        }

        .info-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 20px;
        }

        .info-card-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-card-title i {
            color: var(--active);
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .info-row {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-row.full {
            grid-column: span 2;
        }

        .info-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .info-value {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .info-value code {
            font-family: 'SF Mono', 'Consolas', monospace;
            background: var(--bg);
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 700;
        }

        /* LINE ITEMS CARD */
        .line-items-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            overflow: hidden;
        }

        .line-items-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .line-items-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .line-items-title i {
            color: var(--active);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--bg);
        }

        th {
            text-align: left;
            padding: 12px 20px;
            font-size: 11px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        th:last-child {
            text-align: right;
        }

        tbody tr {
            border-bottom: 1px solid var(--border);
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        td {
            padding: 14px 20px;
            font-size: 14px;
            color: var(--text);
        }

        td:last-child {
            text-align: right;
            font-weight: 600;
        }

        .table-total {
            background: var(--bg);
            font-weight: 700;
        }

        .table-total td {
            font-weight: 700;
            font-size: 15px;
        }

        /* NOTE SECTION */
        .note-section {
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            background: var(--bg);
        }

        .note-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.03em;
            margin-bottom: 8px;
        }

        .note-text {
            font-size: 14px;
            line-height: 1.6;
            color: var(--text);
        }

        /* COLLAPSIBLE SECTIONS */
        .collapsible-section {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            overflow: hidden;
        }

        .collapsible-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .collapsible-header:hover {
            background: var(--bg);
        }

        .collapsible-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .collapsible-title i {
            color: var(--active);
            font-size: 16px;
        }

        .collapsible-toggle {
            color: var(--text-muted);
            font-size: 12px;
            transition: transform 0.3s;
        }

        .collapsible-toggle.open {
            transform: rotate(180deg);
        }

        .collapsible-content {
            display: none;
            padding: 0 20px 20px 20px;
            border-top: 1px solid var(--border);
        }

        .collapsible-content.open {
            display: block;
        }

        /* RECEIPT SETTINGS */
        .receipt-layout {
            display: grid;
            grid-template-columns: 340px 1fr;
            gap: 20px;
            padding-top: 16px;
        }

        @media (max-width: 1100px) {
            .receipt-layout {
                grid-template-columns: 1fr;
            }
        }

        .receipt-controls {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .control-group-label {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.03em;
            margin-bottom: 8px;
        }

        .format-buttons {
            display: flex;
            gap: 8px;
        }

        .format-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 8px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
        }

        .format-btn i {
            font-size: 18px;
            color: var(--text-muted);
        }

        .format-btn:hover {
            border-color: var(--active);
        }

        .format-btn.active {
            border-color: var(--active);
            background: rgba(var(--active-rgb), 0.08);
            color: var(--active);
        }

        .format-btn.active i {
            color: var(--active);
        }

        .mode-toggle {
            display: flex;
            background: var(--bg);
            border-radius: 10px;
            padding: 4px;
            gap: 4px;
        }

        .mode-toggle input {
            display: none;
        }

        .mode-toggle label {
            flex: 1;
            text-align: center;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-muted);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-toggle input:checked + label {
            background: var(--surface);
            color: var(--active);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .quick-summary {
            padding: 14px;
            background: rgba(var(--active-rgb), 0.05);
            border: 1px solid rgba(var(--active-rgb), 0.15);
            border-radius: 10px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .quick-summary strong {
            color: var(--text);
        }

        .toggle-list {
            display: flex;
            flex-direction: column;
            background: var(--bg);
            border-radius: 10px;
            overflow: hidden;
        }

        .toggle-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            border-bottom: 1px solid var(--border);
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }

        .toggle-item:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--border);
            border-radius: 24px;
            transition: 0.3s;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--active);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        /* RECEIPT PREVIEW */
        .receipt-preview {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            min-height: 500px;
        }

        .preview-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
        }

        .preview-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .preview-label i {
            color: var(--active);
        }

        .zoom-controls {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .zoom-btn {
            width: 28px;
            height: 28px;
            border: 1px solid var(--border);
            background: var(--surface);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text);
            font-size: 12px;
        }

        .zoom-btn:hover {
            border-color: var(--active);
            color: var(--active);
        }

        .zoom-level {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }

        .preview-frame-container {
            overflow: auto;
            background: white;
        }

        .preview-frame {
            width: 100%;
            height: 800px;
            border: none;
            display: block;
            zoom: 0.6;
        }

        /* PRO SECTION */
        .pro-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            border-radius: 5px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .pro-content {
            padding-top: 16px;
        }

        .pro-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .pro-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .pro-field label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
        }

        .pro-field input,
        .pro-field textarea {
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 13px;
            font-family: inherit;
            background: var(--surface);
        }

        .pro-field input:focus,
        .pro-field textarea:focus {
            border-color: var(--active);
            outline: none;
        }

        .pro-field.full {
            grid-column: span 2;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .compact-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .header-amount {
                border: none;
                padding: 16px 0;
                border-top: 1px solid var(--border);
                border-bottom: 1px solid var(--border);
                width: 100%;
                text-align: left;
            }

            .header-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .info-row.full {
                grid-column: span 1;
            }

            .pro-grid {
                grid-template-columns: 1fr;
            }

            .pro-field.full {
                grid-column: span 1;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
</head>
<body>
<div id="nav-container"></div>

<div class="app-container">
    <main class="main-content">
        <!-- TOP BAR (Direction colored) -->
        <div class="tx-topbar" id="txTopbar">
            <div class="kebab-container">
                <button class="btn btn-secondary" id="txMoreBtn" type="button" title="More"><i class="fas fa-ellipsis-v"></i></button>
                <div class="header-menu" id="txMoreMenu" role="menu" aria-label="More actions">
                    <button type="button" onclick="alert('Email Receipt')"><i class="fas fa-envelope"></i> Email</button>
                    <button type="button" class="danger" onclick="if(confirm('Delete this transaction?')) alert('Deleted')"><i class="fas fa-trash"></i> Delete</button>
                </div>
            </div>

            <div class="tx-topbar-inner">
                <!-- Card 1: ID + date + cash box + watermark -->
                <div class="tx-topbar-card tx-info-card" id="txInfoCard">
                    <div class="tx-info-watermark" id="txTypeWatermark">IN</div>
                    <div class="tx-id-top">
                        <span class="tx-id-label">Transaction ID</span>
                    </div>
                    <h1 class="tx-id-value" id="txTitle">—</h1>
                    <div class="header-meta">
                        <span id="txMetaDate"><i class="fas fa-calendar"></i> —</span>
                        <span>•</span>
                        <span id="txMetaCashBox" class="cashbox-chip">
                            <span class="cashbox-dot" aria-hidden="true"></span>
                            <i class="fas fa-building" aria-hidden="true"></i>
                            <span id="txMetaCashBoxText">—</span>
                        </span>
                    </div>
                </div>

                <!-- Card 2: Amount -->
                <div class="tx-topbar-card tx-amount-card" id="txHeaderAmount">
                    <div class="header-amount-label" id="txDirectionLabel">Cash IN</div>
                    <div class="header-amount-value in" id="txAmountValue">—</div>
                </div>

                <!-- Card 3: Actions -->
                <div class="tx-topbar-card tx-actions-card" id="txActionsCard">
                    <button class="btn btn-primary" onclick="window.print()"><i class="fas fa-print"></i> Print</button>
                    <button class="btn btn-secondary" onclick="alert('Download PDF')"><i class="fas fa-file-pdf"></i> Download PDF</button>
                </div>
            </div>
        </div>

        <!-- INFO CARDS ROW -->
        <div class="info-cards-row">
            <!-- Transaction Info -->
            <div class="info-card">
                <div class="info-card-title"><i class="fas fa-info-circle"></i> Transaction Details</div>
                <div class="info-grid">
                    <div class="info-row">
                        <span class="info-label">Receipt ID</span>
                        <span class="info-value" id="txIdCode"><code>—</code></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Date</span>
                        <span class="info-value" id="txDateLong">—</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Cash Box</span>
                        <span class="info-value" id="txCashBoxName">—</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Cash Box ID</span>
                        <span class="info-value" id="txCashBoxCode">—</span>
                    </div>
                    <div class="info-row full">
                        <span class="info-label">Created By</span>
                        <span class="info-value" id="txCreatedBy">—</span>
                    </div>
                </div>
            </div>

            <!-- Contact Info -->
            <div class="info-card">
                <div class="info-card-title"><i class="fas fa-user"></i> Contact</div>
                <div class="info-grid">
                    <div class="info-row">
                        <span class="info-label">Name</span>
                        <span class="info-value" id="txContactName">—</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Contact ID</span>
                        <span class="info-value" id="txContactId">—</span>
                    </div>
                    <div class="info-row full">
                        <span class="info-label">Address</span>
                        <span class="info-value" id="txContactAddress">—</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- LINE ITEMS -->
        <div class="line-items-card">
            <div class="line-items-header">
                <div class="line-items-title"><i class="fas fa-list"></i> Line Items</div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Description</th>
                        <th>Amount</th>
                    </tr>
                </thead>
                <tbody id="txLineItemsBody">
                    <tr><td>—</td><td>—</td></tr>
                </tbody>
            </table>
            <div class="note-section" id="txNoteSection" style="display: none;">
                <div class="note-label">Note</div>
                <div class="note-text" id="txNote"></div>
            </div>
        </div>

        <!-- RECEIPT & PRINT - Collapsible -->
        <div class="collapsible-section">
            <div class="collapsible-header" onclick="toggleSection('receiptSection')">
                <div class="collapsible-title">
                    <i class="fas fa-receipt"></i>
                    Receipt & Print Settings
                </div>
                <i class="fas fa-chevron-down collapsible-toggle" id="receiptSectionToggle"></i>
            </div>
            <div class="collapsible-content" id="receiptSection">
                <div class="receipt-layout">
                    <!-- Controls -->
                    <div class="receipt-controls">
                        <!-- Format -->
                        <div>
                            <div class="control-group-label">Format</div>
                            <div class="format-buttons">
                                <button class="format-btn active" data-format="a4">
                                    <i class="fas fa-copy"></i>
                                    Print
                                </button>
                                <button class="format-btn" data-format="pdf">
                                    <i class="fas fa-file-pdf"></i>
                                    PDF
                                </button>
                                <button class="format-btn" data-format="email">
                                    <i class="fas fa-envelope"></i>
                                    Email
                                </button>
                            </div>
                        </div>

                        <!-- Mode -->
                        <div>
                            <div class="control-group-label">Fields</div>
                            <div class="mode-toggle">
                                <input type="radio" name="receiptMode" id="receiptModeQuick" value="quick" checked>
                                <label for="receiptModeQuick">Quick</label>
                                <input type="radio" name="receiptMode" id="receiptModeDetailed" value="detailed">
                                <label for="receiptModeDetailed">Detailed</label>
                            </div>
                        </div>

                        <!-- Quick Summary -->
                        <div id="receiptQuickSummary" class="quick-summary">
                            <strong>Quick preset:</strong> Logo, addresses, line items, total
                        </div>

                        <!-- Detailed Toggles -->
                        <div id="receiptDetailedToggles" class="toggle-list" style="display: none;">
                            <div class="toggle-item">
                                <span>Logo</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked data-field="logo">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="toggle-item">
                                <span>Addresses</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" checked data-field="addresses">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="toggle-item">
                                <span>Tracking Details</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" data-field="tracking">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="toggle-item">
                                <span>Additional Info</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" data-field="additional">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="toggle-item">
                                <span>Note</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" data-field="note">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="toggle-item">
                                <span>Signatures</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" data-field="signatures">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Preview -->
                    <div class="receipt-preview">
                        <div class="preview-toolbar">
                            <div class="preview-label"><i class="fas fa-eye"></i> Preview</div>
                            <div class="zoom-controls">
                                <button class="zoom-btn" onclick="zoomOut()"><i class="fas fa-minus"></i></button>
                                <span class="zoom-level" id="zoomLevel">60%</span>
                                <button class="zoom-btn" onclick="zoomIn()"><i class="fas fa-plus"></i></button>
                                <button class="zoom-btn" onclick="resetZoom()"><i class="fas fa-redo"></i></button>
                            </div>
                        </div>
                        <div class="preview-frame-container">
                            <iframe id="receiptFrame" class="preview-frame" src="spendnote-receipt-a4-two-copies.html"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PRO OPTIONS - Collapsible -->
        <div class="collapsible-section">
            <div class="collapsible-header" onclick="toggleSection('proSection')">
                <div class="collapsible-title">
                    <i class="fas fa-crown"></i>
                    Pro Options
                    <span class="pro-badge"><i class="fas fa-crown"></i> Pro</span>
                </div>
                <i class="fas fa-chevron-down collapsible-toggle" id="proSectionToggle"></i>
            </div>
            <div class="collapsible-content" id="proSection">
                <div class="pro-content">
                    <div class="pro-grid">
                        <div class="pro-field">
                            <label>Receipt Title</label>
                            <input type="text" placeholder="Cash Receipt">
                        </div>
                        <div class="pro-field">
                            <label>Total Label</label>
                            <input type="text" placeholder="Total handed over">
                        </div>
                        <div class="pro-field">
                            <label>From Label</label>
                            <input type="text" placeholder="FROM">
                        </div>
                        <div class="pro-field">
                            <label>To Label</label>
                            <input type="text" placeholder="TO">
                        </div>
                        <div class="pro-field">
                            <label>Description Label</label>
                            <input type="text" placeholder="Description">
                        </div>
                        <div class="pro-field">
                            <label>Amount Label</label>
                            <input type="text" placeholder="Amount">
                        </div>
                        <div class="pro-field full">
                            <label>Footer Note</label>
                            <textarea rows="2" placeholder="Thank you for your business!"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>
</div>

<footer class="app-footer">
    <div class="app-footer-container">
        <div class="app-footer-top">
            <div class="app-footer-brand">
                <a href="dashboard.html" class="app-footer-brand-logo">
                    <svg width="32" height="32" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 6 C10 4.89543 10.8954 4 12 4 L36 4 C37.1046 4 38 4.89543 38 6 L38 38 L36 40 L34 38 L32 40 L30 38 L28 40 L26 38 L24 40 L22 38 L20 40 L18 38 L16 40 L14 38 L12 40 L10 38 Z" fill="white"/>
                        <path d="M32 4 L38 10 L32 10 Z" fill="rgba(0,0,0,0.15)"/>
                        <path d="M32 4 L32 10 L38 10" stroke="rgba(0,0,0,0.2)" stroke-width="1.5" stroke-linejoin="round"/>
                        <line x1="14" y1="14" x2="30" y2="14" stroke="rgba(0,0,0,0.15)" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="14" y1="19" x2="26" y2="19" stroke="rgba(0,0,0,0.12)" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="14" y1="24" x2="30" y2="24" stroke="rgba(0,0,0,0.15)" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="14" y1="29" x2="22" y2="29" stroke="rgba(0,0,0,0.1)" stroke-width="2.5" stroke-linecap="round"/>
                        <path d="M10 36 L12 38 L14 36 L16 38 L18 36 L20 38 L22 36 L24 38 L26 36 L28 38 L30 36 L32 38 L34 36 L36 38 L38 36" stroke="rgba(0,0,0,0.2)" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>SpendNote</span>
                </a>
                <p class="app-footer-brand-desc">Cash receipt management for modern teams.</p>
            </div>
            <div class="app-footer-right">
                <div class="app-footer-links-simple">
                    <a href="index.html#features">Features</a>
                    <a href="spendnote-pricing.html">Pricing</a>
                    <a href="spendnote-faq.html">FAQ</a>
                    <a href="spendnote-terms.html">Legal</a>
                </div>
                <div class="app-footer-brand-disclaimer">
                    <i class="fas fa-info-circle"></i>
                    <span>Cash handoff documentation only. Not a tax or accounting tool.</span>
                </div>
            </div>
        </div>
        <div class="app-footer-bottom">
            <div class="app-footer-copyright">2026 SpendNote. All rights reserved.</div>
        </div>
    </div>
</footer>

<script>
    const QUICK_PRESET = {
        logo: '1',
        addresses: '1',
        tracking: '0',
        additional: '0',
        note: '0',
        signatures: '0'
    };

    let receiptMode = 'quick';
    let displayOptions = { ...QUICK_PRESET };
    let currentFormat = 'a4';
    let currentZoom = 0.6;

    const txId = new URLSearchParams(window.location.search).get('id');

    function toggleSection(id) {
        const content = document.getElementById(id);
        const toggle = document.getElementById(id + 'Toggle');
        if (content && toggle) {
            content.classList.toggle('open');
            toggle.classList.toggle('open');
        }
    }

    function buildReceiptUrl(format) {
        const baseUrls = {
            'a4': 'spendnote-receipt-a4-two-copies.html',
            'pdf': 'spendnote-pdf-receipt.html',
            'email': 'spendnote-email-receipt.html'
        };
        const params = new URLSearchParams();
        if (txId) params.append('txId', txId);
        for (const [key, value] of Object.entries(displayOptions)) {
            params.append(key, value);
        }
        return `${baseUrls[format]}?${params.toString()}`;
    }

    function reloadIframe() {
        const iframe = document.getElementById('receiptFrame');
        if (iframe) iframe.src = buildReceiptUrl(currentFormat);
    }

    function applyReceiptMode(mode) {
        const m = mode === 'detailed' ? 'detailed' : 'quick';
        receiptMode = m;
        try { localStorage.setItem('spendnote.receiptMode', m); } catch (e) {}

        const quickSummary = document.getElementById('receiptQuickSummary');
        const detailedToggles = document.getElementById('receiptDetailedToggles');
        if (quickSummary) quickSummary.style.display = m === 'quick' ? 'block' : 'none';
        if (detailedToggles) detailedToggles.style.display = m === 'detailed' ? 'block' : 'none';

        document.getElementById('receiptModeQuick').checked = m === 'quick';
        document.getElementById('receiptModeDetailed').checked = m === 'detailed';

        if (m === 'quick') {
            displayOptions = { ...QUICK_PRESET };
            document.querySelectorAll('.toggle-list input[type="checkbox"]').forEach(toggle => {
                const field = toggle.dataset.field;
                if (field) toggle.checked = displayOptions[field] === '1';
            });
        } else {
            document.querySelectorAll('.toggle-list input[type="checkbox"]').forEach(toggle => {
                const field = toggle.dataset.field;
                if (field) displayOptions[field] = toggle.checked ? '1' : '0';
            });
        }
        reloadIframe();
    }

    function updateZoom() {
        const iframe = document.getElementById('receiptFrame');
        const zoomLevel = document.getElementById('zoomLevel');
        if (iframe) iframe.style.zoom = currentZoom;
        if (zoomLevel) zoomLevel.textContent = Math.round(currentZoom * 100) + '%';
    }

    function zoomIn() { currentZoom = Math.min(currentZoom + 0.1, 1.2); updateZoom(); }
    function zoomOut() { currentZoom = Math.max(currentZoom - 0.1, 0.4); updateZoom(); }
    function resetZoom() { currentZoom = 0.6; updateZoom(); }

    document.addEventListener('DOMContentLoaded', function() {
        const moreBtn = document.getElementById('txMoreBtn');
        const moreMenu = document.getElementById('txMoreMenu');
        if (moreBtn && moreMenu) {
            const closeMenu = () => { moreMenu.classList.remove('open'); };
            moreBtn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                moreMenu.classList.toggle('open');
            });
            document.addEventListener('click', function() { closeMenu(); });
            moreMenu.addEventListener('click', function(e) { e.stopPropagation(); });
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') closeMenu();
            });
        }

        try {
            receiptMode = localStorage.getItem('spendnote.receiptMode') === 'detailed' ? 'detailed' : 'quick';
        } catch (e) { receiptMode = 'quick'; }

        document.getElementById('receiptModeQuick')?.addEventListener('change', () => applyReceiptMode('quick'));
        document.getElementById('receiptModeDetailed')?.addEventListener('change', () => applyReceiptMode('detailed'));

        document.querySelectorAll('.format-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFormat = this.dataset.format;
                reloadIframe();
            });
        });

        document.querySelectorAll('.toggle-list input[type="checkbox"]').forEach(toggle => {
            toggle.addEventListener('change', function() {
                if (receiptMode !== 'detailed') return;
                const field = this.dataset.field;
                if (field) {
                    displayOptions[field] = this.checked ? '1' : '0';
                    reloadIframe();
                }
            });
        });

        applyReceiptMode(receiptMode);
        reloadIframe();
        updateZoom();
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="assets/js/supabase-config.js?v=20"></script>
<script src="assets/js/auth-guard.js"></script>
<script src="assets/js/nav-loader.js?v=7"></script>
<script>loadNav();</script>
<script src="assets/js/main.js?v=21"></script>
<script src="assets/js/transaction-detail-data.js?v=header-20260130-8"></script>
</body>
</html>
