<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sign up for SpendNote - Start managing your cash receipts today.">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" type="image/x-icon" href="favicon.ico">
    <title>Sign Up - SpendNote</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/main.css?v=12">
    <style>
        /* ===== SIGNUP PAGE SPECIFIC STYLES ===== */
        
        /* AUTH CONTAINER */
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 24px;
            max-width: 420px;
            width: 100%;
            box-shadow: 0 4px 24px var(--shadow);
        }

        /* LOGO */
        .auth-logo {
            text-align: center;
            margin-bottom: 16px;
        }

        .logo-mark {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .logo-mark svg {
            width: 32px;
            height: 32px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 900;
            color: var(--text);
            letter-spacing: -0.03em;
        }

        /* HEADER */
        .auth-header {
            text-align: center;
            margin-bottom: 16px;
        }

        .auth-title {
            font-size: 22px;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 4px;
        }

        .auth-subtitle {
            color: var(--text-muted);
            font-size: 13px;
        }

        /* FORM */
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }

        .form-input {
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s;
            background: var(--surface);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(5, 150, 105, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-hint {
            font-size: 13px;
            color: var(--text-muted);
        }

        /* PASSWORD STRENGTH */
        .password-strength {
            display: flex;
            gap: 4px;
            margin-top: 8px;
        }

        .strength-bar {
            flex: 1;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            transition: all 0.3s;
        }

        .strength-bar.active {
            background: var(--primary);
        }

        .strength-bar.medium {
            background: #f59e0b;
        }

        .strength-bar.weak {
            background: var(--error);
        }

        .strength-text {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* CHECKBOX */
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .checkbox-input {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .checkbox-label {
            font-size: 14px;
            color: var(--text);
            flex: 1;
        }

        .checkbox-label a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .checkbox-label a:hover {
            text-decoration: underline;
        }

        /* BUTTON */
        /* DIVIDER */
        .divider {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 14px 0;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .divider-text {
            font-size: 13px;
            color: var(--text-muted);
            font-weight: 500;
        }

        /* SOCIAL BUTTONS */
        .social-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .btn-social {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 18px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: var(--surface);
            color: var(--text);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-social:hover {
            border-color: var(--text);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn-social i {
            font-size: 18px;
        }

        .btn-google {
            background: white;
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-google:hover {
            border-color: #4285f4;
            box-shadow: 0 4px 12px rgba(66, 133, 244, 0.2);
        }

        /* FOOTER LINK */
        .auth-footer {
            text-align: center;
            margin-top: 12px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        /* ERROR MESSAGE */
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            color: var(--error);
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* SUCCESS MESSAGE */
        .success-message {
            background: rgba(5, 150, 105, 0.1);
            border: 1px solid var(--success);
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            color: var(--success);
            display: none;
        }

        .success-message.show {
            display: block;
        }

        /* RESPONSIVE */
        @media (max-width: 640px) {
            .auth-card {
                padding: 32px 24px;
            }

            .auth-title {
                font-size: 24px;
            }
        }
    </style></head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <!-- Logo -->
            <div class="auth-logo">
                <a href="dashboard.html" class="logo-mark">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 6 C10 4.89543 10.8954 4 12 4 L36 4 C37.1046 4 38 4.89543 38 6 L38 38 L36 40 L34 38 L32 40 L30 38 L28 40 L26 38 L24 40 L22 38 L20 40 L18 38 L16 40 L14 38 L12 40 L10 38 Z" fill="url(#logo-gradient)"/>
                        <path d="M32 4 L38 10 L32 10 Z" fill="#000000" opacity="0.25"/>
                        <path d="M32 4 L32 10 L38 10" stroke="#047857" stroke-width="1.5" stroke-linejoin="round"/>
                        <line x1="14" y1="14" x2="30" y2="14" stroke="white" stroke-width="2.5" stroke-linecap="round" opacity="0.9"/>
                        <line x1="14" y1="19" x2="26" y2="19" stroke="white" stroke-width="2.5" stroke-linecap="round" opacity="0.8"/>
                        <line x1="14" y1="24" x2="30" y2="24" stroke="white" stroke-width="2.5" stroke-linecap="round" opacity="0.9"/>
                        <line x1="14" y1="29" x2="22" y2="29" stroke="white" stroke-width="2.5" stroke-linecap="round" opacity="0.7"/>
                        <path d="M10 36 L12 38 L14 36 L16 38 L18 36 L20 38 L22 36 L24 38 L26 36 L28 38 L30 36 L32 38 L34 36 L36 38 L38 36" stroke="#047857" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        <defs>
                            <linearGradient id="logo-gradient" x1="24" y1="4" x2="24" y2="40" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="#059669"/>
                                <stop offset="100%" stop-color="#10b981"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <span class="logo-text">SpendNote</span>
                </a>
            </div>

            <!-- Header -->
            <div class="auth-header">
                <h1 class="auth-title">Create your account</h1>
                <p class="auth-subtitle">Start tracking cash receipts in 30 seconds</p>
            </div>

            <!-- Error Message -->
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-circle"></i> Error message will appear here
            </div>

            <!-- Success Message -->
            <div class="success-message" id="successMessage">
                <i class="fas fa-check-circle"></i> Account created! Redirecting...
            </div>

            <!-- Form -->
            <form class="auth-form" id="signupForm">
                <div class="form-group">
                    <label class="form-label" for="fullName">Full name</label>
                    <input 
                        type="text" 
                        id="fullName" 
                        class="form-input" 
                        placeholder="John Doe"
                        required
                    >
                </div>

                <div class="form-group">
                    <label class="form-label" for="email">Email</label>
                    <input 
                        type="email" 
                        id="email" 
                        class="form-input" 
                        placeholder="you@example.com"
                        required
                    >
                </div>

                <div class="form-group">
                    <label class="form-label" for="password">Password</label>
                    <input 
                        type="password" 
                        id="password" 
                        class="form-input" 
                        placeholder="Use at least 1 number or symbol"
                        required
                        minlength="8"
                    >
                    <div class="password-strength" id="passwordStrength">
                        <div class="strength-bar"></div>
                        <div class="strength-bar"></div>
                        <div class="strength-bar"></div>
                        <div class="strength-bar"></div>
                    </div>
                    <span class="strength-text" id="strengthText"></span>
                </div>

                <div class="checkbox-group">
                    <input 
                        type="checkbox" 
                        id="terms" 
                        class="checkbox-input"
                        required
                    >
                    <label class="checkbox-label" for="terms">
                        I agree to the <a href="#" target="_blank">Terms of Service</a> and <a href="#" target="_blank">Privacy Policy</a>
                    </label>
                </div>

                <button type="submit" class="btn btn-primary">
                    Create account
                </button>
            </form>

            <!-- Divider -->
            <div class="divider">
                <span class="divider-text">Or continue with</span>
            </div>

            <!-- Social Buttons -->
            <div class="social-buttons">
                <button type="button" class="btn-social btn-google" id="googleBtn">
                    <svg width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
  <path d="M17.64 9.20455c0-.63864-.05727-1.25227-.16364-1.84091H9v3.48182h4.84364c-.20818 1.125-.84273 2.07818-1.79455 2.71636v2.25818h2.90545c1.70182-1.56636 2.68545-3.87273 2.68545-6.61545z" fill="#4285F4"/>
  <path d="M9 18c2.43 0 4.46727-.80545 5.95636-2.18182l-2.90545-2.25818c-.80545.54-1.83455.85909-3.05091.85909-2.34545 0-4.32818-1.58364-5.03636-3.71091H.95727v2.33273C2.43818 15.98364 5.48182 18 9 18z" fill="#34A853"/>
  <path d="M3.96364 10.70818c-.18-.54-.28227-1.11636-.28227-1.70818s.10227-1.16818.28227-1.70818V4.95909H.95727C.34727 6.17364 0 7.54727 0 9s.34727 2.82636.95727 4.04091l3.00637-2.33273z" fill="#FBBC05"/>
  <path d="M9 3.57955c1.32182 0 2.50727.45455 3.44 1.34636l2.58182-2.58182C13.46364.89182 11.42636 0 9 0 5.48182 0 2.43818 2.01636.95727 4.95909l3.00637 2.33273C4.67182 5.16364 6.65455 3.57955 9 3.57955z" fill="#EA4335"/>
</svg>
                    Sign up with Google
                </button>
            </div>

            <!-- No Card Disclaimer - HIDDEN to save space -->
            <div style="display: none;">
                <i class="fas fa-check-circle" style="color: var(--success);"></i>
                No credit card required
            </div>

            <!-- Footer -->
            <div class="auth-footer">
                Already have an account? <a href="spendnote-login.html">Log in</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/supabase-config.js?v=20260211-2006"></script>
    <script>
        const acceptInviteToken = async (inviteToken) => {
            if (!inviteToken || !window.supabaseClient?.rpc) return;
            try {
                const r = await window.supabaseClient.rpc('spendnote_accept_invite_v2', { p_token: inviteToken });
                if (r?.error) throw r.error;
            } catch (_) {
                try {
                    await window.supabaseClient.rpc('spendnote_accept_invite', { p_token: inviteToken });
                } catch (_) {

                }
            }
        };

        // Wait for DOM and scripts to load
        document.addEventListener('DOMContentLoaded', async function() {
            // Check if already logged in
            const user = await auth.getCurrentUser();
            if (user) {
                try {
                    const sp = new URLSearchParams(window.location.search);
                    const inviteToken = sp.get('inviteToken');
                    await acceptInviteToken(inviteToken);
                } catch (_) {

                }
                window.location.href = 'dashboard.html';
            }

            // Password strength indicator
        const passwordInput = document.getElementById('password');
        const strengthBars = document.querySelectorAll('.strength-bar');
        const strengthText = document.getElementById('strengthText');

        passwordInput.addEventListener('input', function() {
            const password = this.value;
            const strength = calculatePasswordStrength(password);
            
            // Reset bars
            strengthBars.forEach(bar => {
                bar.classList.remove('active', 'weak', 'medium');
            });

            // Set strength
            if (strength >= 1) {
                strengthBars[0].classList.add('active', 'weak');
                strengthText.textContent = 'Weak password';
                strengthText.style.color = 'var(--error)';
            }
            if (strength >= 2) {
                strengthBars[1].classList.add('active', 'medium');
                strengthText.textContent = 'Fair password';
                strengthText.style.color = '#f59e0b';
            }
            if (strength >= 3) {
                strengthBars[2].classList.add('active');
                strengthText.textContent = 'Good password';
                strengthText.style.color = 'var(--success)';
            }
            if (strength >= 4) {
                strengthBars[3].classList.add('active');
                strengthText.textContent = 'Strong password';
                strengthText.style.color = 'var(--success)';
            }
            
            if (password.length === 0) {
                strengthText.textContent = '';
            }
        });

        function calculatePasswordStrength(password) {
            let strength = 0;
            
            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[^a-zA-Z0-9]/.test(password)) strength++;
            
            return Math.min(strength, 4);
        }

        // Form submission
        const signupForm = document.getElementById('signupForm');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');

        signupForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Hide messages
            errorMessage.classList.remove('show');
            successMessage.classList.remove('show');

            // Get form data
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const terms = document.getElementById('terms').checked;

            // Validate
            if (!terms) {
                showError('Please agree to the Terms of Service');
                return;
            }

            if (password.length < 8) {
                showError('Password must be at least 8 characters');
                return;
            }

            // Disable button
            const submitBtn = this.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating account...';

            try {
                // Sign up with Supabase
                const result = await auth.signUp(email, password, fullName);
                
                if (result.success) {
                    try {
                        const sp = new URLSearchParams(window.location.search);
                        const inviteToken = sp.get('inviteToken');
                        await acceptInviteToken(inviteToken);
                    } catch (_) {

                    }

                    // Success
                    successMessage.classList.add('show');
                    successMessage.innerHTML = '<i class="fas fa-check-circle"></i> Account created! Redirecting to settings...';
                    
                    setTimeout(() => {
                        window.location.href = 'spendnote-user-settings.html';
                    }, 1000);
                } else {
                    // Error
                    showError(result.error || 'Failed to create account. Please try again.');
                }
            } catch (error) {
                showError('Network error. Please try again.');
            }
        });

        function showError(message) {
            errorMessage.innerHTML = '<i class="fas fa-exclamation-circle"></i> ' + message;
            errorMessage.classList.add('show');
            
            const submitBtn = signupForm.querySelector('button[type="submit"]');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Create account';
        }

        // Google sign up
        document.getElementById('googleBtn').addEventListener('click', async function() {
            try {
                const { data, error } = await window.supabaseClient.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: `${window.location.origin}/spendnote-user-settings.html`
                    }
                });
                
                if (error) {
                    showError('Google sign up failed. Please try again.');
                }
            } catch (error) {
                showError('Google sign up failed. Please try again.');
            }
        });
        }); // Close DOMContentLoaded
    </script>
</body>
</html>
