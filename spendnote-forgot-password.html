<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QPFM30F86Q"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-QPFM30F86Q');
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Reset your SpendNote password.">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" type="image/x-icon" href="favicon.ico">
    <title>Forgot Password - SpendNote</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/main.css">
    <style>
        /* ===== FORGOT PASSWORD PAGE SPECIFIC STYLES ===== */
        
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
        }

        .auth-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 48px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 4px 24px var(--shadow);
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo-mark {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .logo-mark svg { width: 48px; height: 48px; }

        .logo-text {
            font-size: 28px;
            font-weight: 900;
            color: var(--text);
            letter-spacing: -0.03em;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .auth-title {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -0.02em;
            margin-bottom: 8px;
        }

        .auth-subtitle {
            color: var(--text-muted);
            font-size: 15px;
            line-height: 1.5;
        }

        .auth-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
            font-size: 32px;
            color: white;
            box-shadow: 0 8px 24px rgba(5, 150, 105, 0.3);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .form-input {
            padding: 14px 16px;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
            background: var(--surface);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(5, 150, 105, 0.1);
        }

        .form-input::placeholder { color: var(--text-muted); }

        .auth-footer {
            text-align: center;
            margin-top: 24px;
            font-size: 14px;
            color: var(--text-muted);
        }

        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-footer a:hover { text-decoration: underline; }

        .message {
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            display: none;
        }

        .message.show { display: flex; align-items: center; gap: 10px; }

        .message.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }

        .message.success {
            background: rgba(5, 150, 105, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .success-state {
            display: none;
            text-align: center;
        }

        .success-state.show { display: block; }
        .form-state.hide { display: none; }

        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            margin: 0 auto 24px;
            font-size: 36px;
            color: white;
            box-shadow: 0 8px 24px rgba(5, 150, 105, 0.3);
        }

        .success-state h2 {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 12px;
        }

        .success-state p {
            color: var(--text-muted);
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .email-highlight {
            background: var(--surface-elevated);
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 24px;
            display: inline-block;
        }

        .help-text {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        @media (max-width: 640px) {
            .auth-card { padding: 32px 24px; }
            .auth-title { font-size: 24px; }
        }
    </style></head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <!-- Logo -->
            <div class="auth-logo">
                <a href="/" class="logo-mark">
                    <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 4 C10.895 4 10 4.895 10 6 L10 38 L12 36 L14 38 L16 36 L18 38 L20 36 L22 38 L24 36 L26 38 L28 36 L30 38 L32 36 L34 38 L36 36 L38 38 L38 6 C38 4.895 37.105 4 36 4 Z" fill="url(#logo-gradient)"/>
                        <line x1="14" y1="14" x2="30" y2="14" stroke="white" stroke-width="2.5" stroke-linecap="round" opacity="0.9"/>
                        <line x1="14" y1="19" x2="26" y2="19" stroke="white" stroke-width="2.5" stroke-linecap="round" opacity="0.8"/>
                        <line x1="14" y1="24" x2="30" y2="24" stroke="white" stroke-width="2.5" stroke-linecap="round" opacity="0.9"/>
                        <defs>
                            <linearGradient id="logo-gradient" x1="24" y1="4" x2="24" y2="40" gradientUnits="userSpaceOnUse">
                                <stop offset="0%" stop-color="#059669"/>
                                <stop offset="100%" stop-color="#10b981"/>
                            </linearGradient>
                        </defs>
                    </svg>
                    <span class="logo-text">SpendNote</span>
                </a>
            </div>

            <!-- Form State -->
            <div class="form-state" id="formState">
                <div class="auth-icon">
                    <i class="fas fa-key"></i>
                </div>

                <div class="auth-header">
                    <h1 class="auth-title">Forgot your password?</h1>
                    <p class="auth-subtitle">No worries! Enter your email address and we'll send you a link to reset your password.</p>
                </div>

                <div class="message error" id="errorMessage">
                    <i class="fas fa-exclamation-circle"></i>
                    <span>Error message</span>
                </div>

                <form class="auth-form" id="forgotForm">
                    <div class="form-group">
                        <label class="form-label" for="email">Email address</label>
                        <input 
                            type="email" 
                            id="email" 
                            class="form-input" 
                            placeholder="you@example.com"
                            required
                        >
                    </div>

                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        Send reset link
                    </button>
                </form>

                <div class="auth-footer">
                    <a href="spendnote-login.html"><i class="fas fa-arrow-left"></i> Back to login</a>
                </div>
            </div>

            <!-- Success State -->
            <div class="success-state" id="successState">
                <div class="success-icon">
                    <i class="fas fa-envelope-open-text"></i>
                </div>
                
                <h2>Check your email</h2>
                <p>We've sent a password reset link to:</p>
                <div class="email-highlight" id="sentEmail">your@email.com</div>
                <p>Click the link in the email to reset your password. The link will expire in 1 hour.</p>

                <a href="spendnote-login.html" class="btn btn-primary">
                    Back to login
                </a>

                <div class="help-text">
                    <p>Didn't receive the email? Check your spam folder or <a href="#" id="resendLink">click here to resend</a>.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="assets/js/modal-dialogs.js?v=20260208-1900"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/supabase-config.js?v=20260227-1630"></script>
    <script>
        const forgotForm = document.getElementById('forgotForm');
        const formState = document.getElementById('formState');
        const successState = document.getElementById('successState');
        const errorMessage = document.getElementById('errorMessage');
        const submitBtn = document.getElementById('submitBtn');
        const sentEmail = document.getElementById('sentEmail');
        const resendLink = document.getElementById('resendLink');
        let lastSentEmail = '';

        const setError = (message) => {
            const text = errorMessage.querySelector('span');
            if (text) text.textContent = String(message || 'Something went wrong.');
            errorMessage.classList.add('show');
        };

        const setSendingState = (isSending) => {
            submitBtn.disabled = Boolean(isSending);
            submitBtn.textContent = isSending ? 'Sending...' : 'Send reset link';
        };

        forgotForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            errorMessage.classList.remove('show');

            const email = String(document.getElementById('email').value || '').trim();
            if (!email) {
                setError('Please enter your email address.');
                return;
            }

            if (!window.auth?.resetPassword) {
                setError('Password reset is temporarily unavailable. Please try again later.');
                return;
            }

            setSendingState(true);
            try {
                const result = await window.auth.resetPassword(email);
                if (!result?.success) {
                    setError(result?.error || 'Could not send reset email.');
                    return;
                }

                lastSentEmail = email;
                sentEmail.textContent = email;
                formState.classList.add('hide');
                successState.classList.add('show');
            } catch (err) {
                setError(err?.message || 'Could not send reset email.');
            } finally {
                setSendingState(false);
            }
        });

        resendLink.addEventListener('click', async function(e) {
            e.preventDefault();
            const targetEmail = lastSentEmail || String(document.getElementById('email').value || '').trim();
            if (!targetEmail) {
                showAlert('Missing email address.', { iconType: 'warning' });
                return;
            }
            if (!window.auth?.resetPassword) {
                showAlert('Password reset is temporarily unavailable.', { iconType: 'error' });
                return;
            }

            try {
                const result = await window.auth.resetPassword(targetEmail);
                if (!result?.success) {
                    showAlert(result?.error || 'Could not resend reset email.', { iconType: 'error' });
                    return;
                }
                showAlert('Reset link resent.', { iconType: 'success' });
            } catch (err) {
                showAlert(err?.message || 'Could not resend reset email.', { iconType: 'error' });
            }
        });
    </script>
    <script src="assets/js/main.js?v=33"></script>
</body>
</html>
