<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="Manage your team members and permissions in SpendNote.">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" type="image/x-icon" href="favicon.ico">
    <title>Team Management - SpendNote</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/main.css?v=23">
    <link rel="stylesheet" href="assets/css/app-layout.css?v=19">
    <link rel="stylesheet" href="assets/css/user-settings.css?v=20260223-2200">
    <style>
        /* ===== Team page polish overrides ===== */
        .main-content {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px 16px 28px;
        }

        #teamContent .settings-card {
            border-radius: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 24px var(--shadow);
            padding: 22px;
        }

        .settings-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
        }

        .settings-card-title {
            font-size: 18px;
            font-weight: 800;
            color: var(--text);
        }

        .settings-card-subtitle {
            font-size: 12px;
            color: var(--text-muted);
        }

        .stats-row {
            margin-top: 14px;
            margin-bottom: 16px;
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 10px;
        }

        .stat-box {
            border-radius: 14px;
            border: 1px solid var(--border);
            background: var(--bg);
            padding: 12px 10px;
        }

        .stat-value {
            font-size: 20px;
            line-height: 1.1;
        }

        .team-header-actions {
            gap: 8px;
        }

        .team-table-wrap {
            margin: 0;
            padding: 0;
            border: 1px solid var(--border);
            border-radius: 14px;
            overflow: hidden;
            background: var(--surface);
        }

        .team-table {
            width: 100%;
            min-width: 860px;
            border-collapse: collapse;
        }

        .team-table th {
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            padding: 10px 12px;
        }

        .team-table td {
            padding: 11px 12px;
            font-size: 13px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }

        .team-table tr:hover td {
            background: rgba(var(--active-rgb, 99, 102, 241), 0.04);
        }

        .member-cell {
            gap: 10px;
        }

        .member-avatar {
            width: 34px;
            height: 34px;
            font-size: 11px;
        }

        .member-name {
            font-size: 13px;
            font-weight: 700;
            line-height: 1.2;
        }

        .member-email {
            font-size: 11px;
            margin-top: 2px;
        }

        .role-badge {
            font-size: 11px;
            border-radius: 8px;
            padding: 6px 10px;
            letter-spacing: 0.03em;
        }

        .status-badge {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 999px;
        }

        .team-actions {
            gap: 6px;
        }

        .team-actions .btn {
            font-size: 11px;
            height: 30px;
            padding: 0 10px;
        }

        .org-name-panel {
            margin-top: 10px;
            margin-bottom: 14px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: var(--bg);
            display: none;
        }

        .org-name-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .org-name-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .org-name-row input {
            flex: 1;
            min-width: 0;
            height: 34px;
        }

        .org-name-note {
            margin-top: 8px;
            font-size: 11px;
            color: var(--text-muted);
        }

        /* Invite modal CB checkboxes */
        .invite-cb-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .invite-cb-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.1s;
            user-select: none;
        }

        .invite-cb-item:hover {
            background: rgba(var(--active-rgb, 99, 102, 241), 0.04);
        }

        .invite-cb-item input[type="checkbox"] {
            accent-color: var(--primary);
            width: 15px;
            height: 15px;
            flex-shrink: 0;
        }

        .invite-cb-item .invite-cb-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .invite-cb-item .invite-cb-name {
            font-size: 13px;
            font-weight: 600;
        }

        @media (max-width: 900px) {
            .team-header-actions {
                width: 100%;
            }

            .team-header-actions .btn {
                flex: 1 1 calc(50% - 4px);
                justify-content: center;
            }

            .stats-row {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 640px) {
            .main-content {
                padding: 14px 10px 22px;
            }

            #teamContent .settings-card {
                border-radius: 14px;
                padding: 14px;
            }

            .stats-row {
                grid-template-columns: 1fr;
            }

            .team-table {
                min-width: 100%;
            }

            .team-table thead {
                display: none;
            }

            .team-table,
            .team-table tbody,
            .team-table tr,
            .team-table td {
                display: block;
                width: 100%;
            }

            .team-table tr {
                border-bottom: 1px solid var(--border);
                padding: 10px;
                background: var(--surface);
            }

            .team-table tr:last-child {
                border-bottom: none;
            }

            .team-table td {
                border-bottom: none;
                padding: 5px 0;
                text-align: left !important;
            }

            .team-table td::before {
                display: block;
                font-size: 10px;
                color: var(--text-muted);
                text-transform: uppercase;
                letter-spacing: 0.05em;
                margin-bottom: 4px;
                font-weight: 700;
            }

            .team-table td:nth-child(2)::before { content: 'Role'; }
            .team-table td:nth-child(3)::before { content: 'Status'; }
            .team-table td:nth-child(4)::before { content: 'Actions'; }

            .team-table td:first-child::before {
                content: '';
                display: none;
            }

            .team-actions {
                justify-content: flex-start;
                width: 100%;
            }

            .team-actions .btn {
                height: 32px;
            }

            .org-name-row {
                flex-direction: column;
                align-items: stretch;
            }

            .modal-content {
                width: calc(100vw - 20px);
                max-height: 88vh;
            }
        }
    </style>
</head>
<body>
<div id="nav-container"></div>

<div class="app-container">
    <main class="main-content">
        <div class="page-header">
            <div class="page-title-group">
                <h1 class="page-title">Team <span class="badge badge-warning" style="font-size:13px;vertical-align:middle;">PRO</span></h1>
                <p class="page-subtitle">Manage your team members and Cash Box access</p>
            </div>
        </div>

        <!-- LOADING -->
        <div id="teamLoading" style="text-align:center;padding:48px 24px;color:var(--text-muted);">
            <i class="fas fa-spinner fa-spin" style="font-size:20px;margin-bottom:10px;display:block;"></i>
            Loading team...
        </div>

        <!-- ERROR -->
        <div id="teamError" class="settings-card" style="display:none;text-align:center;padding:48px 24px;">
            <i class="fas fa-exclamation-triangle" style="font-size:28px;color:#f59e0b;margin-bottom:10px;display:block;"></i>
            <div style="font-size:15px;font-weight:700;margin-bottom:6px;">Could not load team data</div>
            <div style="color:var(--text-muted);margin-bottom:14px;font-size:13px;" id="teamErrorMsg">Please check your connection and try again.</div>
            <button type="button" class="btn btn-secondary" onclick="location.reload()"><i class="fas fa-redo"></i> Retry</button>
        </div>

        <!-- MAIN CONTENT (original settings-style layout) -->
        <div id="teamContent" style="display:none;">
            <div class="settings-card">
                <div class="settings-card-header">
                    <div>
                        <div class="settings-card-title">Team Management</div>
                        <div class="settings-card-subtitle">Manage members and their permissions</div>
                    </div>
                    <div class="team-header-actions" id="teamHeaderActions" style="display:none;">
                        <button type="button" class="btn btn-secondary btn-small" id="manageAccessBtn"><i class="fas fa-key"></i> Cash Box Access</button>
                        <button type="button" class="btn btn-primary btn-small" id="inviteMemberBtn"><i class="fas fa-user-plus"></i> Invite</button>
                    </div>
                </div>

                <div class="org-name-panel" id="orgNamePanel">
                    <div class="org-name-title">Team name</div>
                    <div class="org-name-row">
                        <input type="text" id="orgNameInput" placeholder="e.g. Acme Finance Team">
                        <button type="button" class="btn btn-primary btn-small" id="orgNameSaveBtn">Save</button>
                    </div>
                    <div class="org-name-note" id="orgNameNote">Team tagok ezt látják belépéskor, amikor kiválasztják a teamet.</div>
                </div>

                <div class="stats-row">
                    <div class="stat-box">
                        <div class="stat-label">Total Members</div>
                        <div class="stat-value" id="statTotalMembers">—</div>
                        <div class="stat-note" id="statMembersNote">of plan limit</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Active</div>
                        <div class="stat-value" id="statActiveMembers">—</div>
                        <div class="stat-note">Members active</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Pending</div>
                        <div class="stat-value" id="statPendingMembers">—</div>
                        <div class="stat-note">Awaiting acceptance</div>
                    </div>
                </div>
                <div class="team-table-wrap">
                    <table class="team-table">
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="teamTableBody">
                            <tr><td colspan="4" style="text-align:center;color:var(--text-muted);padding:24px;"><i class="fas fa-spinner fa-spin"></i> Loading team...</td></tr>
                        </tbody>
                    </table>
                </div>
                <div style="margin-top:16px;font-size:12px;color:var(--text-muted);"><i class="fas fa-info-circle"></i> Admins can access all Cash Boxes. Configure per-cash-box access for Users via "Cash Box Access".</div>
            </div>
        </div>
    </main>
</div>

<!-- MODAL: Invite Team Member -->
<div class="modal-backdrop" id="inviteModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">Invite Team Member</div>
            <button type="button" class="modal-close" id="inviteModalClose">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group" style="margin-bottom:16px;">
                <label for="inviteEmail">Email Address</label>
                <input type="email" id="inviteEmail" required placeholder="colleague@example.com">
            </div>
            <div class="form-group" style="margin-bottom:16px;">
                <label for="inviteRole">Role</label>
                <select id="inviteRole">
                    <option value="user">User — Can record transactions in assigned Cash Boxes</option>
                    <option value="admin">Admin — Full access to all Cash Boxes</option>
                </select>
            </div>
            <div class="form-group" id="inviteCashBoxGroup">
                <label>Cash Box Access</label>
                <div style="font-size:12px;color:var(--text-muted);margin-bottom:8px;">Select which Cash Boxes this member can use. Admins get access to all.</div>
                <div id="inviteCashBoxList" class="invite-cb-list"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="inviteModalCancel">Cancel</button>
            <button type="button" class="btn btn-primary" id="inviteModalSubmit"><i class="fas fa-paper-plane"></i> Send Invite</button>
        </div>
    </div>
</div>

<!-- MODAL: Cash Box Access -->
<div class="modal-backdrop" id="accessModal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">Manage Cash Box Access</div>
            <button type="button" class="modal-close" id="accessModalClose">&times;</button>
        </div>
        <div class="modal-body">
            <div id="accessMemberPickerWrap" style="display:none;margin-bottom:14px;">
                <label for="accessMemberSelect" style="display:block;font-size:12px;font-weight:700;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.04em;margin-bottom:6px;">Member</label>
                <select id="accessMemberSelect" class="team-role-select" style="width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:var(--surface);"></select>
            </div>
            <div style="margin-bottom:16px;">
                <strong id="accessMemberName">—</strong>
                <div style="font-size:13px;color:var(--text-muted);" id="accessMemberEmail">—</div>
            </div>
            <div style="font-size:13px;margin-bottom:12px;color:var(--text-muted);">Select which Cash Boxes this member can access:</div>
            <div class="access-list" id="accessCashBoxList">
                <div style="text-align:center;color:var(--text-muted);padding:20px;"><i class="fas fa-spinner fa-spin"></i> Loading...</div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" id="accessModalClose2">Close</button>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="app-footer">
    <div class="app-footer-container">
        <div class="app-footer-top">
            <div class="app-footer-brand">
                <a href="dashboard.html" class="app-footer-brand-logo">
                    <svg width="32" height="32" viewBox="0 0 48 48" fill="none"><path d="M10 6 C10 4.89543 10.8954 4 12 4 L36 4 C37.1046 4 38 4.89543 38 6 L38 38 L36 40 L34 38 L32 40 L30 38 L28 40 L26 38 L24 40 L22 38 L20 40 L18 38 L16 40 L14 38 L12 40 L10 38 Z" fill="white"/><path d="M32 4 L38 10 L32 10 Z" fill="rgba(0,0,0,0.15)"/></svg>
                    <span>SpendNote</span>
                </a>
                <p class="app-footer-brand-desc">Cash receipt management for modern teams.</p>
            </div>
            <div class="app-footer-right">
                <div class="app-footer-links-simple">
                    <a href="index.html#features">Features</a>
                    <a href="spendnote-pricing.html">Pricing</a>
                    <a href="spendnote-faq.html">FAQ</a>
                    <a href="spendnote-terms.html">Legal</a>
                </div>
                <div class="app-footer-brand-disclaimer"><i class="fas fa-info-circle"></i><span>Cash handoff documentation only. Not a tax or accounting tool.</span></div>
            </div>
        </div>
        <div class="app-footer-bottom"><div class="app-footer-copyright">2026 SpendNote. All rights reserved.</div></div>
    </div>
</footer>

<script src="assets/js/modal-dialogs.js?v=20260208-1900"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="assets/js/supabase-config.js?v=20260223-2316"></script>
<script src="assets/js/auth-guard.js?v=20260223-1949"></script>
<script src="assets/js/nav-loader.js?v=20260223-2101"></script>
<script>loadNav();</script>
<script src="assets/js/main.js?v=27"></script>
<script src="assets/js/team-page.js?v=20260223-2315"></script>
</body>
</html>
