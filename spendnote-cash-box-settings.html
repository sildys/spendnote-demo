<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cash Box settings in SpendNote.">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" type="image/x-icon" href="favicon.ico">
    <title>Cash Box Settings - SpendNote</title>
    <script>
        (function() {
            try {
                var c = localStorage.getItem('activeCashBoxColor');
                var r = localStorage.getItem('activeCashBoxRgb');
                if (c && r) {
                    document.documentElement.style.setProperty('--active', c);
                    document.documentElement.style.setProperty('--active-rgb', r);
                }
            } catch (e) {}
        })();
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/main.css?v=12">
    <link rel="stylesheet" href="assets/css/app-layout.css?v=13">
    <link rel="stylesheet" href="assets/css/cash-box-settings.css?v=2">
</head>
<body>
<div id="nav-container"></div>

<div class="app-container">
    <main class="main-content">
        <!-- PAGE HEADER -->
        <div class="page-header" style="margin-bottom: 16px;">
            <h1 class="page-title">Cash Box Settings</h1>
            <p class="page-subtitle" id="cashBoxSettingsSubtitle">Configure —</p>
        </div>

        <!-- SUMMARY HEADER CARD -->
        <div class="summary-card">
            <div class="summary-left">
                <div class="summary-icon" id="summaryIcon">
                    <i class="fas fa-building"></i>
                </div>
                <div class="summary-info">
                    <div class="summary-id" id="summaryId">SN-007</div>
                    <div class="summary-name" id="summaryName">Main Office</div>
                </div>
            </div>
            <div class="summary-center">
                <div class="summary-balance-label">CURRENT BALANCE</div>
                <div class="summary-balance" id="summaryBalance">$18,500</div>
            </div>
            <div class="summary-right">
                <button class="summary-btn in" id="summaryInBtn"><i class="fas fa-arrow-down"></i> IN</button>
                <button class="summary-btn out" id="summaryOutBtn"><i class="fas fa-arrow-up"></i> OUT</button>
                <a href="spendnote-cash-box-detail.html" class="summary-btn history" id="summaryHistoryBtn"><i class="fas fa-history"></i> Cash Box History</a>
            </div>
        </div>

        <!-- SETTINGS CARDS: General + Appearance + Team -->
        <div class="settings-topbar">
            <div class="settings-top-grid">
                <!-- GENERAL CARD -->
                <div class="settings-card">
                    <div class="settings-card-title"><i class="fas fa-cog"></i> General</div>
                    <div class="general-fields">
                        <div class="field-row-3">
                            <div class="field-group">
                                <label class="field-label"><i class="fas fa-tag"></i> Cash Box Name</label>
                                <input type="text" class="field-input" id="cashBoxNameInput" placeholder="e.g., Main Office">
                                <span class="field-hint">Appears on receipts</span>
                            </div>
                            <div class="field-group">
                                <label class="field-label"><i class="fas fa-coins"></i> Currency</label>
                                <input type="text" class="field-input" id="currencySelect" list="currencyList" value="USD" autocapitalize="characters" autocomplete="off" spellcheck="false">
                                <datalist id="currencyList">
                                    <option value="USD" label="US Dollar ($)"></option>
                                    <option value="EUR" label="Euro (€)"></option>
                                    <option value="GBP" label="British Pound (£)"></option>
                                    <option value="HUF" label="Hungarian Forint (Ft)"></option>
                                    <option value="JPY" label="Japanese Yen (¥)"></option>
                                    <option value="CHF" label="Swiss Franc (CHF)"></option>
                                    <option value="CAD" label="Canadian Dollar (CA$)"></option>
                                    <option value="AUD" label="Australian Dollar (A$)"></option>
                                </datalist>
                                <span class="field-warning"><i class="fas fa-exclamation-triangle"></i> Changing currency won't convert existing amounts</span>
                            </div>
                            <div class="field-group">
                                <label class="field-label"><i class="fas fa-hashtag"></i> ID Prefix <span class="pro-badge" style="font-size: 9px; padding: 2px 5px;"><i class="fas fa-crown"></i> Pro</span></label>
                                <input type="text" class="field-input" id="idPrefixInput" value="SN" placeholder="SN" maxlength="10">
                                <span class="field-hint">Receipt ID format</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- APPEARANCE CARD -->
                <div class="settings-card">
                    <div class="settings-card-title"><i class="fas fa-palette"></i> Appearance</div>
                    <div class="appearance-content">
                        <div class="appearance-row">
                            <label class="appearance-label">Accent Color</label>
                            <div class="color-palette" id="colorPalette">
                                <!-- Row 1: Greens & Teals -->
                                <div class="color-option selected" style="background: #059669;" data-color="#059669" data-rgb="5, 150, 105" title="Emerald"></div>
                                <div class="color-option" style="background: #10b981;" data-color="#10b981" data-rgb="16, 185, 129" title="Green"></div>
                                <div class="color-option" style="background: #14b8a6;" data-color="#14b8a6" data-rgb="20, 184, 166" title="Teal"></div>
                                <div class="color-option" style="background: #06b6d4;" data-color="#06b6d4" data-rgb="6, 182, 212" title="Cyan"></div>
                                <!-- Row 2: Blues -->
                                <div class="color-option" style="background: #0ea5e9;" data-color="#0ea5e9" data-rgb="14, 165, 233" title="Sky"></div>
                                <div class="color-option" style="background: #3b82f6;" data-color="#3b82f6" data-rgb="59, 130, 246" title="Blue"></div>
                                <div class="color-option" style="background: #6366f1;" data-color="#6366f1" data-rgb="99, 102, 241" title="Indigo"></div>
                                <div class="color-option" style="background: #8b5cf6;" data-color="#8b5cf6" data-rgb="139, 92, 246" title="Violet"></div>
                                <!-- Row 3: Purples & Pinks -->
                                <div class="color-option" style="background: #a855f7;" data-color="#a855f7" data-rgb="168, 85, 247" title="Purple"></div>
                                <div class="color-option" style="background: #d946ef;" data-color="#d946ef" data-rgb="217, 70, 239" title="Fuchsia"></div>
                                <div class="color-option" style="background: #ec4899;" data-color="#ec4899" data-rgb="236, 72, 153" title="Pink"></div>
                                <div class="color-option" style="background: #f43f5e;" data-color="#f43f5e" data-rgb="244, 63, 94" title="Rose"></div>
                                <!-- Row 4: Oranges & Yellows -->
                                <div class="color-option" style="background: #ef4444;" data-color="#ef4444" data-rgb="239, 68, 68" title="Red"></div>
                                <div class="color-option" style="background: #f97316;" data-color="#f97316" data-rgb="249, 115, 22" title="Orange"></div>
                                <div class="color-option" style="background: #f59e0b;" data-color="#f59e0b" data-rgb="245, 158, 11" title="Amber"></div>
                                <div class="color-option" style="background: #eab308;" data-color="#eab308" data-rgb="234, 179, 8" title="Yellow"></div>
                                <!-- Row 5: Neutrals -->
                                <div class="color-option" style="background: #64748b;" data-color="#64748b" data-rgb="100, 116, 139" title="Slate"></div>
                                <div class="color-option" style="background: #78716c;" data-color="#78716c" data-rgb="120, 113, 108" title="Stone"></div>
                            </div>
                        </div>
                        <div class="appearance-row">
                            <label class="appearance-label">Icon</label>
                            <div class="icon-palette" id="iconPalette">
                                <div class="icon-option selected" data-icon="fa-building"><i class="fas fa-building"></i></div>
                                <div class="icon-option" data-icon="fa-store"><i class="fas fa-store"></i></div>
                                <div class="icon-option" data-icon="fa-cash-register"><i class="fas fa-cash-register"></i></div>
                                <div class="icon-option" data-icon="fa-wallet"><i class="fas fa-wallet"></i></div>
                                <div class="icon-option" data-icon="fa-piggy-bank"><i class="fas fa-piggy-bank"></i></div>
                                <div class="icon-option" data-icon="fa-landmark"><i class="fas fa-landmark"></i></div>
                                <div class="icon-option" data-icon="fa-briefcase"><i class="fas fa-briefcase"></i></div>
                                <div class="icon-option" data-icon="fa-home"><i class="fas fa-home"></i></div>
                                <div class="icon-option" data-icon="fa-star"><i class="fas fa-star"></i></div>
                                <div class="icon-option" data-icon="fa-heart"><i class="fas fa-heart"></i></div>
                                <div class="icon-option" data-icon="fa-gift"><i class="fas fa-gift"></i></div>
                                <div class="icon-option" data-icon="fa-calendar-alt"><i class="fas fa-calendar-alt"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TEAM ACCESS CARD -->
            <div class="settings-card team-card">
                <div class="team-header" onclick="toggleTeamAccess()" style="cursor: pointer;">
                    <div class="settings-card-title" style="margin-bottom: 0;"><i class="fas fa-users"></i> Team Access <span class="pro-badge" style="font-size: 9px; padding: 2px 5px;"><i class="fas fa-crown"></i> Pro</span></div>
                    <div class="team-header-right">
                        <span class="team-count">3 members</span>
                        <i class="fas fa-chevron-down" id="teamToggleIcon" style="transition: transform 0.3s; color: var(--text-muted); font-size: 12px;"></i>
                    </div>
                </div>
                <div class="team-content" id="teamContent" style="display: none;">
                    <div class="team-members-list">
                        <div class="team-member-row">
                            <img src="https://i.pravatar.cc/150?img=12" alt="John Doe" class="team-avatar">
                            <div class="team-member-info">
                                <div class="team-member-name">John Doe</div>
                                <div class="team-member-role">Owner</div>
                            </div>
                        </div>
                        <div class="team-member-row">
                            <img src="https://i.pravatar.cc/150?img=5" alt="Jane Smith" class="team-avatar">
                            <div class="team-member-info">
                                <div class="team-member-name">Jane Smith</div>
                                <div class="team-member-role">Admin</div>
                            </div>
                        </div>
                        <div class="team-member-row">
                            <img src="https://i.pravatar.cc/150?img=8" alt="Mike Johnson" class="team-avatar">
                            <div class="team-member-info">
                                <div class="team-member-name">Mike Johnson</div>
                                <div class="team-member-role">Viewer</div>
                            </div>
                        </div>
                    </div>
                    <a href="spendnote-user-settings.html?tab=team" class="team-manage-link"><i class="fas fa-cog"></i> Manage in Settings</a>
                </div>
            </div>
        </div>

        <!-- RECEIPT & PRO OPTIONS GRID -->
        <div class="settings-grid">
            <!-- RECEIPT & PRINT -->
            <div class="collapsible-section">
                <div class="collapsible-header">
                    <div class="collapsible-title">
                        <i class="fas fa-receipt"></i>
                        Receipt & Print Settings
                    </div>
                </div>
                <div class="collapsible-content" id="receiptSection">
                    <div class="receipt-layout">
                        <!-- Controls -->
                        <div class="receipt-controls">
                            <!-- Format -->
                            <div>
                                <div class="control-group-label">Default Format</div>
                                <div class="format-buttons">
                                    <button class="format-btn active" data-format="a4">
                                        <i class="fas fa-copy"></i>
                                        Print
                                    </button>
                                    <button class="format-btn" data-format="pdf">
                                        <i class="fas fa-file-pdf"></i>
                                        PDF
                                    </button>
                                    <button class="format-btn" data-format="email">
                                        <i class="fas fa-envelope"></i>
                                        Email
                                    </button>
                                </div>
                            </div>

                            <!-- Mode -->
                            <div>
                                <div class="control-group-label">Fields</div>
                                <div class="mode-toggle">
                                    <input type="radio" name="receiptMode" id="receiptModeQuick" value="quick" checked>
                                    <label for="receiptModeQuick">Quick</label>
                                    <input type="radio" name="receiptMode" id="receiptModeDetailed" value="detailed">
                                    <label for="receiptModeDetailed">Detailed</label>
                                </div>
                            </div>

                            <!-- Quick Summary -->
                            <div id="receiptQuickSummary" class="quick-summary">
                                <strong>Quick preset:</strong> Logo, addresses, line items, total, signatures
                            </div>

                            <!-- Detailed Toggles -->
                            <div id="receiptDetailedToggles" class="toggle-list" style="display: none;">
                                <div class="toggle-item">
                                    <span>Logo</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked data-field="logo">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="toggle-item">
                                    <span>Addresses</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked data-field="addresses">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="toggle-item">
                                    <span>Receipt IDs</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" data-field="tracking">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="toggle-item">
                                    <span>Additional IDs</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" data-field="additional">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="toggle-item">
                                    <span>Notes</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" data-field="note">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                <div class="toggle-item">
                                    <span>Signatures</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked data-field="signatures">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Preview -->
                        <div class="receipt-preview">
                            <div class="preview-toolbar">
                                <div class="preview-label"><i class="fas fa-eye"></i> Preview</div>
                                <div class="zoom-controls">
                                    <button class="zoom-btn" id="zoomOutBtn" type="button"><i class="fas fa-minus"></i></button>
                                    <span class="zoom-level" id="zoomLevel">60%</span>
                                    <button class="zoom-btn" id="zoomInBtn" type="button"><i class="fas fa-plus"></i></button>
                                    <button class="zoom-btn" id="zoomResetBtn" type="button"><i class="fas fa-redo"></i></button>
                                </div>
                            </div>
                            <div class="preview-frame-container" id="receiptPreviewContainer">
                                <iframe id="receiptFrame" class="preview-frame" src="about:blank"></iframe>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PRO OPTIONS -->
            <div class="collapsible-section">
                <div class="collapsible-header">
                    <div class="collapsible-title">
                        <i class="fas fa-crown"></i>
                        Pro Options
                        <span class="pro-badge"><i class="fas fa-crown"></i> Pro</span>
                    </div>
                </div>
                <div class="collapsible-content" id="proSection">
                    <div class="pro-content">
                        <div class="pro-grid">
                            <div class="pro-field full">
                                <label>Logo</label>
                                <div class="pro-logo-box">
                                    <div class="pro-logo-preview" id="logoPreview"><img id="logoPreviewImg" alt="" /></div>
                                    <div class="pro-logo-actions">
                                        <input type="file" id="logoInput" accept="image/png,image/jpeg,image/jpg,image/svg+xml" style="display: none;">
                                        <button type="button" class="btn btn-secondary" id="uploadLogoBtn"><i class="fas fa-upload"></i> Upload</button>
                                        <button type="button" class="btn btn-secondary" id="removeLogoBtn" style="display: none;"><i class="fas fa-trash"></i> Remove</button>
                                    </div>
                                </div>
                            </div>
                            <div class="pro-field">
                                <label>Receipt Title</label>
                                <input type="text" id="receiptTitle" placeholder="Cash Receipt">
                            </div>
                            <div class="pro-field">
                                <label>Total Label</label>
                                <input type="text" id="totalLabel" placeholder="Total handed over">
                            </div>
                            <div class="pro-field">
                                <label>From Label</label>
                                <input type="text" id="fromLabel" placeholder="FROM">
                            </div>
                            <div class="pro-field">
                                <label>To Label</label>
                                <input type="text" id="toLabel" placeholder="TO">
                            </div>
                            <div class="pro-field">
                                <label>Description Label</label>
                                <input type="text" id="descriptionLabel" placeholder="Description">
                            </div>
                            <div class="pro-field">
                                <label>Amount Label</label>
                                <input type="text" id="amountLabel" placeholder="Amount">
                            </div>
                            <div class="pro-field full">
                                <label>Footer Note</label>
                                <textarea rows="2" id="footerNote" placeholder="Thank you for your business!"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- DANGER ZONE -->
        <div class="danger-section">
            <div class="danger-header">
                <i class="fas fa-exclamation-triangle"></i>
                <span class="danger-title">Danger Zone</span>
            </div>
            <div class="danger-content">
                <div class="danger-text">Permanently delete this Cash Box and all associated transactions. This action cannot be undone.</div>
                <button class="danger-btn" id="deleteButton"><i class="fas fa-trash"></i> Delete Cash Box</button>
            </div>
        </div>

    </main>
</div>

<!-- SAVE ACTIONS -->
<div class="save-actions">
    <div class="save-actions-inner">
        <button class="btn btn-secondary">Cancel</button>
        <button class="btn btn-primary">Save Changes</button>
    </div>
</div>

<footer class="app-footer">
    <div class="app-footer-container">
        <div class="app-footer-top">
            <div class="app-footer-brand">
                <a href="dashboard.html" class="app-footer-brand-logo">
                    <svg width="32" height="32" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 6 C10 4.89543 10.8954 4 12 4 L36 4 C37.1046 4 38 4.89543 38 6 L38 38 L36 40 L34 38 L32 40 L30 38 L28 40 L26 38 L24 40 L22 38 L20 40 L18 38 L16 40 L14 38 L12 40 L10 38 Z" fill="white"/>
                        <path d="M32 4 L38 10 L32 10 Z" fill="rgba(0,0,0,0.15)"/>
                        <path d="M32 4 L32 10 L38 10" stroke="rgba(0,0,0,0.2)" stroke-width="1.5" stroke-linejoin="round"/>
                        <line x1="14" y1="14" x2="30" y2="14" stroke="rgba(0,0,0,0.15)" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="14" y1="19" x2="26" y2="19" stroke="rgba(0,0,0,0.12)" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="14" y1="24" x2="30" y2="24" stroke="rgba(0,0,0,0.15)" stroke-width="2.5" stroke-linecap="round"/>
                        <line x1="14" y1="29" x2="22" y2="29" stroke="rgba(0,0,0,0.1)" stroke-width="2.5" stroke-linecap="round"/>
                        <path d="M10 36 L12 38 L14 36 L16 38 L18 36 L20 38 L22 36 L24 38 L26 36 L28 38 L30 36 L32 38 L34 36 L36 38 L38 36" stroke="rgba(0,0,0,0.2)" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>SpendNote</span>
                </a>
                <p class="app-footer-brand-desc">Cash receipt management for modern teams.</p>
            </div>
            <div class="app-footer-right">
                <div class="app-footer-links-simple">
                    <a href="index.html#features">Features</a>
                    <a href="spendnote-pricing.html">Pricing</a>
                    <a href="spendnote-faq.html">FAQ</a>
                    <a href="spendnote-terms.html">Legal</a>
                </div>
                <div class="app-footer-brand-disclaimer">
                    <i class="fas fa-info-circle"></i>
                    <span>Cash handoff documentation only. Not a tax or accounting tool.</span>
                </div>
            </div>
        </div>
        <div class="app-footer-bottom">
            <div class="app-footer-copyright">2026 SpendNote. All rights reserved.</div>
        </div>
    </div>
</footer>

<script>
// ===== DUMMY DATA FOR RECEIPT PREVIEW =====
const DUMMY_TX = {
    id: 'demo-preview',
    display_id: 'SN1-042',
    transaction_date: new Date().toISOString().split('T')[0],
    type: 'in',
    amount: 250.00,
    description: 'Office supplies reimbursement',
    contact_name: 'John Smith',
    contact_address: '123 Main Street, Suite 100, New York, NY 10001',
    contact_custom_field_1: 'EMP-2847',
    note: 'Reimbursement for Q1 office supplies purchase',
    line_items: [
        { description: 'Printer paper (5 reams)', amount: 89.50 },
        { description: 'Ink cartridges', amount: 124.00 },
        { description: 'Sticky notes & pens', amount: 36.50 }
    ],
    cash_box: {
        name: 'Main Office',
        sequence_number: 1,
        currency: 'USD'
    },
    created_by_user_name: 'Sarah Johnson'
};

const DUMMY_PROFILE = {
    company_name: 'Acme Corporation',
    full_name: 'Robert Williams',
    address: '456 Business Ave, Floor 12, New York, NY 10002'
};

// ===== RECEIPT PREVIEW =====
let displayOptions = {
    logo: '1',
    addresses: '1',
    tracking: '1',
    additional: '1',
    note: '1',
    signatures: '1'
};

let currentFormat = 'a4';
let currentZoom = 0.6;

function buildReceiptUrl(format) {
    const baseUrls = {
        'a4': 'spendnote-receipt-a4-two-copies.html',
        'pdf': 'spendnote-pdf-receipt.html',
        'email': 'spendnote-email-receipt.html'
    };
    
    const params = new URLSearchParams();
    params.append('v', 'settings-preview-01');
    params.append('demo', '1');
    
    // Display options
    for (const [key, value] of Object.entries(displayOptions)) {
        params.append(key, value);
    }
    
    // Dummy data params
    params.append('demoCompany', DUMMY_PROFILE.company_name);
    params.append('demoAddress', DUMMY_PROFILE.address);
    params.append('demoContact', DUMMY_TX.contact_name);
    params.append('demoContactAddress', DUMMY_TX.contact_address);
    params.append('demoAmount', DUMMY_TX.amount);
    params.append('demoCurrency', DUMMY_TX.cash_box.currency);
    params.append('demoDate', DUMMY_TX.transaction_date);
    params.append('demoReceiptId', DUMMY_TX.display_id);
    params.append('demoCashBoxId', 'SN-001');
    params.append('demoNote', DUMMY_TX.note);
    params.append('demoCreatedBy', DUMMY_TX.created_by_user_name);
    
    // Pro text customizations
    const receiptTitle = document.getElementById('receiptTitle')?.value;
    const totalLabel = document.getElementById('totalLabel')?.value;
    const fromLabel = document.getElementById('fromLabel')?.value;
    const toLabel = document.getElementById('toLabel')?.value;
    const descriptionLabel = document.getElementById('descriptionLabel')?.value;
    const amountLabel = document.getElementById('amountLabel')?.value;
    const footerNote = document.getElementById('footerNote')?.value;
    
    if (receiptTitle) params.append('receiptTitle', receiptTitle);
    if (totalLabel) params.append('totalLabel', totalLabel);
    if (fromLabel) params.append('fromLabel', fromLabel);
    if (toLabel) params.append('toLabel', toLabel);
    if (descriptionLabel) params.append('descriptionLabel', descriptionLabel);
    if (amountLabel) params.append('amountLabel', amountLabel);
    if (footerNote) params.append('footerNote', footerNote);
    
    return `${baseUrls[format]}?${params.toString()}`;
}

function reloadIframe() {
    const iframe = document.getElementById('receiptFrame');
    if (iframe) {
        iframe.src = buildReceiptUrl(currentFormat);
    }
}

function updateZoom() {
    const iframe = document.getElementById('receiptFrame');
    const zoomLevel = document.getElementById('zoomLevel');
    if (iframe && zoomLevel) {
        iframe.style.zoom = currentZoom;
        zoomLevel.textContent = Math.round(currentZoom * 100) + '%';
    }
}

// ===== COLOR PICKER =====
document.querySelectorAll('.color-option').forEach(option => {
    option.addEventListener('click', function() {
        document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');
        
        const color = this.dataset.color;
        const rgb = this.dataset.rgb;
        if (color && rgb) {
            document.documentElement.style.setProperty('--active', color);
            document.documentElement.style.setProperty('--active-rgb', rgb);
            try {
                localStorage.setItem('activeCashBoxColor', color);
                localStorage.setItem('activeCashBoxRgb', rgb);
            } catch (e) {}
        }
    });
});

// ===== ICON PICKER =====
document.querySelectorAll('.icon-option').forEach(option => {
    option.addEventListener('click', function() {
        document.querySelectorAll('.icon-option').forEach(opt => opt.classList.remove('selected'));
        this.classList.add('selected');
    });
});

// ===== FORMAT BUTTONS =====
document.querySelectorAll('.format-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        currentFormat = this.dataset.format;
        reloadIframe();
    });
});

// ===== MODE TOGGLE =====
document.querySelectorAll('input[name="receiptMode"]').forEach(radio => {
    radio.addEventListener('change', function() {
        const quickSummary = document.getElementById('receiptQuickSummary');
        const detailedToggles = document.getElementById('receiptDetailedToggles');
        if (this.value === 'quick') {
            quickSummary.style.display = 'block';
            detailedToggles.style.display = 'none';
        } else {
            quickSummary.style.display = 'none';
            detailedToggles.style.display = 'flex';
        }
    });
});

// ===== TOGGLE SWITCHES =====
document.querySelectorAll('.toggle-list input[type="checkbox"]').forEach(toggle => {
    toggle.addEventListener('change', function() {
        const field = this.dataset.field;
        if (field) {
            displayOptions[field] = this.checked ? '1' : '0';
            reloadIframe();
        }
    });
});

// ===== PRO TEXT FIELDS =====
['receiptTitle', 'totalLabel', 'fromLabel', 'toLabel', 'descriptionLabel', 'amountLabel', 'footerNote'].forEach(fieldId => {
    const field = document.getElementById(fieldId);
    if (field) {
        field.addEventListener('input', function() {
            reloadIframe();
        });
    }
});

// ===== ZOOM CONTROLS =====
document.getElementById('zoomOutBtn')?.addEventListener('click', () => {
    if (currentZoom > 0.4) {
        currentZoom = Math.max(currentZoom - 0.05, 0.4);
        updateZoom();
    }
});

document.getElementById('zoomInBtn')?.addEventListener('click', () => {
    if (currentZoom < 1.2) {
        currentZoom = Math.min(currentZoom + 0.05, 1.2);
        updateZoom();
    }
});

document.getElementById('zoomResetBtn')?.addEventListener('click', () => {
    currentZoom = 0.6;
    updateZoom();
});

// ===== LOGO UPLOAD =====
const logoInput = document.getElementById('logoInput');
const uploadLogoBtn = document.getElementById('uploadLogoBtn');
const removeLogoBtn = document.getElementById('removeLogoBtn');
const logoPreview = document.getElementById('logoPreview');
const logoPreviewImg = document.getElementById('logoPreviewImg');

uploadLogoBtn?.addEventListener('click', () => logoInput?.click());

logoInput?.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const validTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/svg+xml'];
    if (!validTypes.includes(file.type)) {
        alert('Please upload a PNG, JPG, or SVG file.');
        return;
    }
    
    if (file.size > 2 * 1024 * 1024) {
        alert('File size must be less than 2MB.');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = function(event) {
        logoPreviewImg.src = event.target.result;
        logoPreview.classList.add('visible');
        removeLogoBtn.style.display = 'inline-flex';
        try {
            localStorage.setItem('spendnote.proLogoDataUrl', event.target.result);
        } catch (e) {}
        reloadIframe();
    };
    reader.readAsDataURL(file);
});

removeLogoBtn?.addEventListener('click', () => {
    logoPreviewImg.src = '';
    logoPreview.classList.remove('visible');
    removeLogoBtn.style.display = 'none';
    logoInput.value = '';
    try {
        localStorage.removeItem('spendnote.proLogoDataUrl');
    } catch (e) {}
    reloadIframe();
});

// ===== DELETE BUTTON =====
document.getElementById('deleteButton')?.addEventListener('click', function() {
    const name = document.getElementById('cashBoxNameInput')?.value || 'this Cash Box';
    if (confirm(`Are you sure you want to delete "${name}"?\n\nThis will permanently delete:\n• This Cash Box\n• All transactions\n• All associated data\n\nThis action cannot be undone.`)) {
        alert('Cash Box deleted (demo only)');
    }
});

// ===== TEAM ACCESS TOGGLE =====
function toggleTeamAccess() {
    const content = document.getElementById('teamContent');
    const icon = document.getElementById('teamToggleIcon');
    if (content && icon) {
        const isHidden = content.style.display === 'none';
        content.style.display = isHidden ? 'block' : 'none';
        icon.style.transform = isHidden ? 'rotate(180deg)' : 'rotate(0deg)';
    }
}

// ===== INIT =====
window.addEventListener('DOMContentLoaded', function() {
    reloadIframe();
    updateZoom();
    
    // Load saved logo
    try {
        const savedLogo = localStorage.getItem('spendnote.proLogoDataUrl');
        if (savedLogo && logoPreviewImg && logoPreview && removeLogoBtn) {
            logoPreviewImg.src = savedLogo;
            logoPreview.classList.add('visible');
            removeLogoBtn.style.display = 'inline-flex';
        }
    } catch (e) {}
});
</script>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="assets/js/supabase-config.js?v=20"></script>
<script src="assets/js/auth-guard.js"></script>
<script src="assets/js/nav-loader.js?v=7"></script>
<script>loadNav();</script>
<script src="assets/js/main.js?v=20"></script>
<script src="assets/js/cash-box-settings-data.js?v=12"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof initCashBoxSettings === 'function') {
            initCashBoxSettings();
        }
    });
</script>
</body>
</html>
